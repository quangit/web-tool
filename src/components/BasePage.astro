---
import BaseLayout from '../layouts/BaseLayout.astro';
import Sidebar from '../components/Sidebar.astro';
import PageHeader from '../components/PageHeader.astro';
import { useTranslations } from '../i18n/utils';

interface Props {
  title: string;
  description: string;
  activePage: string;
}

const { title, description, activePage } = Astro.props;
const { lang = 'en' } = Astro.params;
const t = useTranslations(lang as any);

// Generate breadcrumb structured data
const pathParts = activePage.split('/').filter(Boolean);
const breadcrumbItems = [
  {
    '@type': 'ListItem',
    position: 1,
    name: 'Home',
    item: `https://webtool.center/${lang}`,
  },
];

// Build breadcrumb trail
let currentPath = `/${lang}`;
pathParts.forEach((part, index) => {
  currentPath += `/${part}`;
  breadcrumbItems.push({
    '@type': 'ListItem',
    position: index + 2,
    name: part
      .split('-')
      .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
      .join(' '),
    item: `https://webtool.center${currentPath}`,
  });
});

const breadcrumbStructuredData = {
  '@context': 'https://schema.org',
  '@type': 'BreadcrumbList',
  itemListElement: breadcrumbItems,
};
---

<BaseLayout title={`${title} - Web Tools`} description={description}>
  <!-- Breadcrumb Structured Data -->
  <script
    type="application/ld+json"
    set:html={JSON.stringify(breadcrumbStructuredData)}
    slot="head-extra"
  />

  <div id="app">
    <Sidebar activePage={activePage} />
    <div id="content">
      <div class="top-nav">
        <button
          id="sidebar-toggler"
          aria-controls="sidebar"
          aria-expanded="false"
          aria-label={t('sidebar.toggle_menu')}
        >
          <i data-lucide="menu"></i>
        </button>
      </div>
      <PageHeader title={title} description={description} />
      <main>
        <slot />
      </main>
    </div>
    <div id="message"></div>
  </div>
</BaseLayout>
