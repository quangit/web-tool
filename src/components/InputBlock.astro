---
import { useTranslations } from '../i18n/utils';
import CopyButton from './CopyButton.astro';
import FullscreenButton from './FullscreenButton.astro';
const {
  id = 'input',
  title = 'Input',
  placeholder = 'Enter here...',
  readonly = false,
  showFullscreen = true,
  showCopy = false,
  copyMessage = 'Copied',
  // File upload support
  showFileUpload = false,
  fileId = 'file',
  // Data attributes
  dataRemember = null,
  dataShare = null,

  dataEncodingFrom = null,
  dataAutoUpdate = false,
  dataToggleMonaco = true,
  dataLanguage = null,
} = Astro.props;

// Build data attributes object
const dataAttrs: Record<string, any> = {};
if (dataRemember) {
  dataAttrs['data-remember'] = dataRemember;
}
if (dataShare) {
  dataAttrs['data-share'] = dataShare;
}
if (dataEncodingFrom) {
  dataAttrs['data-encoding-from'] = dataEncodingFrom;
}
if (dataAutoUpdate) {
  dataAttrs['data-auto-update'] = true;
}
if (dataToggleMonaco) {
  dataAttrs['data-toggle'] = 'monacoEditor';
}
if (dataLanguage) {
  dataAttrs['data-language'] = dataLanguage;
}

const { lang = 'en' } = Astro.params;
const t = useTranslations(lang as any);
---

<div class="input">
  <div class="block block-fill">
    <div class="block-title">
      {title}
      <div class="toolbar">
        {showCopy && <CopyButton target={`#${id}`} message={copyMessage} />}
        {showFullscreen && <FullscreenButton />}
      </div>
    </div>
    <textarea
      class="container"
      id={id}
      spellcheck="false"
      placeholder={placeholder}
      readonly={readonly ? 'readonly' : undefined}
      {...dataAttrs}></textarea>
    {
      showFileUpload && (
        <div class="droppable-zone container" id="droppable-zone" style="display:none;">
          <input class="droppable-file" type="file" id={fileId} data-auto-update />
          <div class="droppable-zone-wrapper">
            <i class="droppable-zone-icon" data-lucide="file-up" />
            <div class="droppable-zone-text">{t('drag_drop')}</div>
          </div>
        </div>
      )
    }
  </div>
</div>

{
  showFileUpload && (
    <div id="file-upload-scripts" data-file-upload="true" style="display:none;"></div>
  )
}

{
  showFileUpload && (
    <script is:inline>
      ++waitLoadCount;
      delayScripts.push({
        src: '/js/file-loader.js?v=10',
        onload: function () {
          methodLoad();
        },
      });
    </script>
  )
}
