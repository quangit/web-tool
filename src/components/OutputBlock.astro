---
import { useTranslations } from '../i18n/utils';
import BaseOutputBlock from './BaseOutputBlock.astro';
import CopyButton from './CopyButton.astro';

interface Props {
  id?: string;
  title?: string;
  placeholder?: string;
  copyMessage?: string;
  showFullscreen?: boolean;
  showCopy?: boolean;
  showDownload?: boolean;
  downloadId?: string;
  downloadFilename?: string;
  // Data attributes
  dataEncodingFrom?: string | null;
  dataToggleMonaco?: boolean;
  dataLanguage?: string | null;
  // Share link
  showShareLink?: boolean;
  isReadonly?: boolean;
  textareaStyle?: string;
  hasTextarea?: boolean;
}

const {
  id = 'output',
  title = 'Output',
  placeholder = 'Output here...',
  copyMessage = 'Output copied',
  showFullscreen = true,
  showCopy = true,
  showDownload = false,
  downloadId = 'download-image',
  downloadFilename = 'download',
  // Data attributes
  dataEncodingFrom = null,
  dataToggleMonaco = true,
  dataLanguage = null,
  // Share link
  showShareLink = true,
  isReadonly = true,
  textareaStyle = '',
  hasTextarea = true,
} = Astro.props;

// Build data attributes object
const dataAttrs: Record<string, any> = {};
if (dataEncodingFrom) {
  dataAttrs['data-encoding-from'] = dataEncodingFrom;
}
if (dataToggleMonaco) {
  dataAttrs['data-toggle'] = 'monacoEditor';
}
if (dataLanguage) {
  dataAttrs['data-language'] = dataLanguage;
}

const { lang = 'en' } = Astro.params;
const t = useTranslations(lang as any);
---

<BaseOutputBlock
  title={title}
  showFullscreen={showFullscreen}
  showCopy={showCopy}
  showDownload={showDownload}
  copyTarget={`#${id}`}
  copyMessage={copyMessage}
  downloadId={downloadId}
  downloadFilename={downloadFilename}
>
  <slot name="toolbar" slot="toolbar" />
  <Fragment>
    <slot name="before-textarea" />
    {
      hasTextarea && (
        <textarea
          class="container"
          id={id}
          spellcheck="false"
          placeholder={placeholder}
          readonly={isReadonly ? 'readonly' : undefined}
          style={textareaStyle}
          {...dataAttrs}
        />
      )
    }
    <slot name="after-textarea" />
  </Fragment>
  {
    showShareLink && (
      <details class="block text-only" data-toggle="copyblock" slot="extra">
        <summary class="block-title">
          {t('share_link')}
          <div class="toolbar">
            <CopyButton target="#share-link" message="Share link copied" />
          </div>
        </summary>
        <input id="share-link" type="text" placeholder={t('share_link')} readonly="readonly" />
      </details>
    )
  }
</BaseOutputBlock>
