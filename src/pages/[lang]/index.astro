---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Sidebar from '../../components/Sidebar.astro';
import PageHeader from '../../components/PageHeader.astro';
import { toolSections } from '../../data/toolSections';
import { languages } from '../../i18n/ui';
import { useTranslations } from '../../i18n/utils';
import '../../styles/index-page.css';

export function getStaticPaths() {
  return Object.keys(languages).map((lang) => ({ params: { lang } }));
}

const { lang = 'en' } = Astro.params;
const t = useTranslations(lang as any);

// i18n data for client-side scripts
const i18nData = {
  noResult: t('sidebar.search.no_result'),
  found: t('sidebar.search.found'),
  empty: t('sidebar.my_tools.empty'),
  lang,
};
---

<BaseLayout title={t('sidebar.title')} description={t('sidebar.description')}>
  <div id="app">
    <Sidebar />
    <div id="content">
      <div class="top-nav">
        <button
          id="sidebar-toggler"
          aria-controls="sidebar"
          aria-expanded="false"
          aria-label={t('sidebar.toggle_menu')}
        >
          <i data-lucide="menu"></i>
        </button>
      </div>
      <PageHeader title={t('sidebar.title')} description={t('sidebar.description')} />

      <main>
        <div id="index">
          <!-- My Tools Card -->
          <div class="section" id="my-tools-card">
            <h2>{t('sidebar.my_tools')}</h2>
            <ol id="favorite-tools-list" class="blocks">
              <li class="empty-state">{t('sidebar.my_tools.empty')}</li>
            </ol>
          </div>

          <hr />

          <!-- Search Box -->
          <div class="section" id="search-section">
            <div class="search-container">
              <input
                type="text"
                id="tool-search"
                placeholder={t('sidebar.search')}
                autocomplete="off"
              />
              <div id="search-results-count"></div>
            </div>
          </div>

          <!-- Tool Sections -->
          {
            toolSections.map((section) => (
              <div class="section" data-section={section.title.toLowerCase().replace(/\s+/g, '-')}>
                <h2 class="section-title">
                  <button class="section-toggle" type="button" aria-expanded="true">
                    <svg
                      class="section-arrow"
                      width="12"
                      height="12"
                      viewBox="0 0 12 12"
                      fill="none"
                      aria-hidden="true"
                    >
                      <path
                        d="M3 5L6 8L9 5"
                        stroke="currentColor"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                    <span>{section.title}</span>
                  </button>
                </h2>
                <div class="section-content">
                  <div class="blocks">
                    {section.blocks.map((block) => (
                      <div class="block">
                        <h3>{block.title}</h3>
                        <nav>
                          <ol>
                            {block.items.map((item) => (
                              <li>
                                <a href={`/${lang}/${item.url}`}>
                                  {item.icon && <i data-lucide={item.icon} class="tool-icon" />}
                                  <span>{item.name}</span>
                                </a>
                              </li>
                            ))}
                          </ol>
                        </nav>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            ))
          }
        </div>
      </main>
    </div>
    <div id="message"></div>

    <!-- i18n data for client-side scripts -->
    <script is:inline id="i18n-data" type="application/json" set:html={JSON.stringify(i18nData)} />
  </div>

  <!-- Import modular scripts -->
  <script>
    import '../../scripts/index/index';
  </script>
</BaseLayout>
