---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Sidebar from '../../components/Sidebar.astro';
import PageHeader from '../../components/PageHeader.astro';
import { toolSections } from '../../data/toolSections';
import { languages } from '../../i18n/ui';
import { useTranslations } from '../../i18n/utils';
import '../../styles/index-page.css';
import '../../styles/user-tools.css';

export function getStaticPaths() {
  return Object.keys(languages).map((lang) => ({ params: { lang } }));
}

const { lang = 'en' } = Astro.params;
const t = useTranslations(lang as any);

// i18n data for client-side scripts
const i18nData = {
  noResult: t('sidebar.search.no_result'),
  found: t('sidebar.search.found'),
  empty: t('sidebar.my_tools.empty'),
  lang,
};

// User tools i18n data
const userToolsI18n = {
  title: t('user_tools.title'),
  addCard: t('user_tools.add_card'),
  addItem: t('user_tools.add_item'),
  edit: t('user_tools.edit'),
  delete: t('user_tools.delete'),
  deleteConfirm: t('user_tools.delete_confirm'),
  empty: t('user_tools.empty'),
  popup: {
    addCard: t('user_tools.popup.add_card'),
    editCard: t('user_tools.popup.edit_card'),
    cardName: t('user_tools.popup.card_name'),
    cardNamePlaceholder: t('user_tools.popup.card_name_placeholder'),
    addItem: t('user_tools.popup.add_item'),
    editItem: t('user_tools.popup.edit_item'),
    selectCard: t('user_tools.popup.select_card'),
    selectCardPlaceholder: t('user_tools.popup.select_card_placeholder'),
    icon: t('user_tools.popup.icon'),
    iconPlaceholder: t('user_tools.popup.icon_placeholder'),
    title: t('user_tools.popup.title'),
    titlePlaceholder: t('user_tools.popup.title_placeholder'),
    description: t('user_tools.popup.description'),
    descriptionPlaceholder: t('user_tools.popup.description_placeholder'),
    url: t('user_tools.popup.url'),
    urlPlaceholder: t('user_tools.popup.url_placeholder'),
    openNewWindow: t('user_tools.popup.open_new_window'),
    save: t('user_tools.popup.save'),
    cancel: t('user_tools.popup.cancel'),
    deleteConfirm: t('user_tools.delete_confirm'),
    iconPickerTitle: t('user_tools.icon_picker.title'),
    iconPickerSearch: t('user_tools.icon_picker.search'),
    iconPickerNoResult: t('user_tools.icon_picker.no_result'),
  },
};
---

<BaseLayout title={t('sidebar.title')} description={t('sidebar.description')}>
  <div id="app">
    <Sidebar />
    <div id="content">
      <div class="top-nav">
        <button
          id="sidebar-toggler"
          aria-controls="sidebar"
          aria-expanded="false"
          aria-label={t('sidebar.toggle_menu')}
        >
          <i data-lucide="menu"></i>
        </button>
      </div>
      <PageHeader title={t('sidebar.title')} description={t('sidebar.description')} />

      <main>
        <div id="index">
          <!-- My Tools Card -->
          <div class="section" id="my-tools-card">
            <h2>{t('sidebar.my_tools')}</h2>
            <ol id="favorite-tools-list" class="blocks">
              <li class="empty-state">{t('sidebar.my_tools.empty')}</li>
            </ol>
          </div>

          <hr />

          <!-- Search Box -->
          <div class="section" id="search-section">
            <div class="search-container">
              <input
                type="text"
                id="tool-search"
                placeholder={t('sidebar.search')}
                autocomplete="off"
              />
              <div id="search-results-count"></div>
            </div>
          </div>

          <!-- User Custom Tools Section -->
          <div class="section" id="user-tools-section">
            <div class="section-header">
              <h2>{t('user_tools.title')}</h2>
              <div class="section-actions">
                <button type="button" class="btn-add" id="btn-add-card">
                  <i data-lucide="plus"></i>
                  <span>{t('user_tools.add_card')}</span>
                </button>
                <button type="button" class="btn-add" id="btn-add-item">
                  <i data-lucide="plus"></i>
                  <span>{t('user_tools.add_item')}</span>
                </button>
              </div>
            </div>
            <div id="user-cards-container">
              <div class="empty-state">{t('user_tools.empty')}</div>
            </div>
          </div>

          <!-- Tool Sections -->
          {
            toolSections.map((section) => (
              <div class="section" data-section={section.title.toLowerCase().replace(/\s+/g, '-')}>
                <h2 class="section-title">
                  <button class="section-toggle" type="button" aria-expanded="true">
                    <svg
                      class="section-arrow"
                      width="12"
                      height="12"
                      viewBox="0 0 12 12"
                      fill="none"
                      aria-hidden="true"
                    >
                      <path
                        d="M3 5L6 8L9 5"
                        stroke="currentColor"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                    <span>{section.title}</span>
                  </button>
                </h2>
                <div class="section-content">
                  <div class="blocks">
                    {section.blocks.map((block) => (
                      <div class="block">
                        <h3>{block.title}</h3>
                        <nav>
                          <ol>
                            {block.items.map((item) => (
                              <li>
                                <a href={`/${lang}/${item.url}`}>
                                  {item.icon && <i data-lucide={item.icon} class="tool-icon" />}
                                  <span>{item.name}</span>
                                </a>
                              </li>
                            ))}
                          </ol>
                        </nav>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            ))
          }
        </div>
      </main>
    </div>
    <div id="message"></div>

    <!-- i18n data for client-side scripts -->
    <script is:inline id="i18n-data" type="application/json" set:html={JSON.stringify(i18nData)} />

    <!-- User tools i18n data -->
    <script
      is:inline
      id="user-tools-i18n"
      type="application/json"
      set:html={JSON.stringify(userToolsI18n)}
    />
  </div>

  <!-- Import modular scripts -->
  <script>
    import '../../scripts/index/index';
  </script>
</BaseLayout>
