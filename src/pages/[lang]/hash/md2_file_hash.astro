---
import BaseHashPage from '../../../components/BaseHashPage.astro';
import OutputEncodingSelect from '../../../components/OutputEncodingSelect.astro';
import HMACSettings from '../../../components/HMACSettings.astro';
import FileTypeSelect from '../../../components/FileTypeSelect.astro';
import { languages } from '../../../i18n/ui';
import { useTranslations } from '../../../i18n/utils';

export function getStaticPaths() {
  return Object.keys(languages).map((lang) => {
    return { params: { lang } };
  });
}

const { lang = 'en' } = Astro.params;
const t = useTranslations(lang as any);
---

<BaseHashPage
  title={t('md2_file_hash.title')}
  description={t('md2_file_hash.description')}
  activePage="hash/md2_file_hash"
  isUseFile={true}
>
  <div class="setting">
    <label for="file-type">{t('input_type')}</label>
    <FileTypeSelect id="file-type" dataRemember="file-type" dataAutoUpdate={true} />
  </div>

  <div class="setting">
    <label for="output-type">{t('output_encoding')}</label>
    <OutputEncodingSelect id="output-type" dataShare="output_type" dataAutoUpdate={true} />
  </div>

  <HMACSettings />

  <!-- Load HMAC support FIRST (like in HTML) -->
  <script is:inline slot="scripts">
    ++waitLoadCount;
    delayScripts.push({
      src: '/js/hmac.js?v=2',
    });
  </script>

  <!-- Load crypto-api wrapper and set window.method -->
  <script is:inline slot="scripts">
    ++waitLoadCount;
    delayScripts.push({
      src: '/js/crypto-api.js',
      onload: function () {
        window.method = md2;
        methodLoad();
      },
    });
  </script>

  <!-- Load crypto-api library from CDN -->
  <script is:inline slot="scripts">
    ++waitLoadCount;
    delayScripts.push({
      src: 'https://nf404.github.io/crypto-api/crypto-api.min.js',
      onload: function () {
        methodLoad();
      },
    });
  </script>

  <!-- Load encoding support -->
  <script is:inline slot="scripts">
    ++waitLoadCount;
    delayScripts.push({
      src: '/js/encoding.js?v=8',
      onload: function () {
        methodLoad();
      },
    });
  </script>

  <!-- Load file processing scripts -->
  <script is:inline slot="scripts">
    ++waitLoadCount;
    delayScripts.push({
      src: '/js/url-blob.js?v=1',
      onload: function () {
        methodLoad();
      },
    });
    ++waitLoadCount;
    delayScripts.push({
      src: '/js/droppable-file.js',
      onload: function () {
        methodLoad();
      },
    });
    ++waitLoadCount;
    delayScripts.push({
      src: '/js/file.js?v=10',
      onload: function () {
        methodLoad();
      },
    });
  </script>
</BaseHashPage>
